From d5f930c06f4da1c98aa6175a10f50615122341ab Mon Sep 17 00:00:00 2001
From: Benjamin Kaduk <kaduk@mit.edu>
Date: Mon, 25 Mar 2013 11:17:23 -0400
Subject: CVE patch from krb5-1.10.1+dfsg-4+nmu1

---
 src/plugins/preauth/pkinit/pkinit_srv.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/plugins/preauth/pkinit/pkinit_srv.c b/src/plugins/preauth/pkinit/pkinit_srv.c
index 3322310..c531bb7 100644
--- a/src/plugins/preauth/pkinit/pkinit_srv.c
+++ b/src/plugins/preauth/pkinit/pkinit_srv.c
@@ -1017,8 +1017,8 @@ pkinit_server_return_padata(krb5_context context,
         (rep != NULL && rep->choice == choice_pa_pk_as_rep_dhInfo)) {
 
         /* If mutually supported KDFs were found, use the alg agility KDF */
-        if (rep->u.dh_Info.kdfID) {
-            secret.data = server_key;
+        if (rep != NULL && rep->u.dh_Info.kdfID) {
+            secret.data = (char *)server_key;
             secret.length = server_key_len;
 
             retval = pkinit_alg_agility_kdf(context, &secret,
